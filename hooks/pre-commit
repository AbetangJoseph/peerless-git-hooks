#!/bin/bash
# Author: Abetang, Joseph Abetang
# Created: 10-05-2025

echo "Commencing pre-commit checks..."

# Don't run for merge or squash commits
if [[ "$2" == "merge" || "$2" == "squash" ]]; then
  exit 0
fi

BRANCH_NAME=$(git rev-parse --abbrev-ref HEAD)
PATTERN='^(feature|bugfix|hotfix|chore|refactor|test|ops|docs|spike)/[A-Z]+-[0-9]+/.+$'

echo "üîç Checking branch adherence to standards..."

if [[ "$BRANCH_NAME" =~ $PATTERN ]]; then
  echo "‚úÖ Branch name is valid."
  exit 0
else
  echo "‚ùå Invalid branch name: '$BRANCH_NAME'"
  echo "Expected format: <type>/<TICKET-ID>/<short-description>"
  echo "Acceptable types: feature|bugfix|hotfix|chore|refactor|test|ops|docs|spike"
  echo "Example: feature/ABC-123/account-name-enquiry"
  exit 1
fi
